---
title: "Circadian Measures and Cognition"
author: "Megan McMahon"
date: "9/11/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(reshape2)
library(readr)

rpx <- read_csv("~/Box/CogNeuroLab/Aging Decision Making R01/Data/Actigraphy/Combined Export File.csv")

efficiency <- aggregate(efficiency ~ subject_id, rpx, mean, na.action = na.omit)
sleep_time <- aggregate(sleep_time ~ subject_id, rpx, mean, na.action = na.omit)
percent_wake <- aggregate(percent_wake ~ subject_id, rpx, mean, na.action = na.omit)
onset_latency <- aggregate(onset_latency ~ subject_id, rpx, mean, na.action = na.omit)
total_ac <- aggregate(total_ac ~ subject_id, rpx, mean, na.action = na.omit)

rpx2 <- merge(efficiency, sleep_time, by = 'subject_id')
rpx2 <- merge(rpx2, percent_wake, by = 'subject_id')
rpx2 <- merge(rpx2, onset_latency, by = 'subject_id')
rpx2 <- merge(rpx2, total_ac, by = 'subject_id')
head(rpx2)

cr <- read_csv('~/Box/CogNeuroLab/Aging Decision Making R01/Data/CR/circadian_rhythms_2019-09-07.csv')
cr$actquot <- cr$actamp/cr$actmesor

neuro <- read_csv('~/Box/CogNeuroLab/Aging Decision Making R01/Data/Neuropsych/AgingDecMemNeuropsyc_DATA_2019-06-12_0708.csv')

bct <- read_csv('~/Box/CogNeuroLab/Aging Decision Making R01/Analysis/rest/bct/bct_x.csv')

d <- merge(cr, neuro, by='record_id', all=TRUE)
d <- merge(d, bct, by='record_id', all=TRUE)
d <- merge(d, rpx2, by.x = 'record_id', by.y = 'subject_id', all=TRUE)
d <- d[(d$age >= 18) & (d$age <= 90) & !is.na(d$age), ]
d$group <- factor(ifelse(d$record_id < 40000, 0, 1))
d$group_name <- factor(ifelse(d$record_id < 40000, 0, 1), labels = c('Young Adults', 'Older Adults'))

save(d, file = "~/Box/CogNeuroLab/Aging Decision Making R01/Data/combined_data.RData")

```


```{r summary statistics}

d %>%
  select(age, IS:fact, group) %>%
  group_by(group) %>%
  summary() 

d %>%
  filter(group == 1) %>%
  select(age, IS:fact) %>%
  summary()

d.mlt <- melt(select(d, record_id, group_name, IS:actquot, -rsqact, -fnlrgact, -L5_starttime, -M10_starttime), id.vars=c('record_id', 'group_name'))

ggplot(data = d.mlt, aes(x = variable, y = value, group = group_name)) + 
  geom_violin(aes(fill = group_name)) + 
  facet_wrap( ~ variable,  scales='free') + 
  theme_minimal() +
  scale_fill_manual(values = c("blue", "red")) +
  xlab(element_blank()) + ylab(element_blank())

```

```{r Age group differences in rest-activity measures}

# Stability from day to day
t.test(IS ~ group, data = d) # 0.00142
t.test(IV ~ group, data = d)
t.test(RA ~ group, data = d)
t.test(actamp ~ group, data = d)
t.test(fact ~ group, data = d)

# Morningness preference
t.test(actphi ~ group, data = d) # p = 1.541e-08
t.test(actupmesor ~ group, data = d) # p = 8.015e-05
t.test(actdownmesor~ group, data = d) # p = 4.229e-09

#Sleep Measures
t.test(sleep_time ~ group, data = d) #NS
t.test(percent_wake ~ group, data = d) #p = 0.03961
t.test(onset_latency ~ group, data = d) #p = 0.0066
t.test(efficiency ~ group, data = d) #NS
```

```{r Effect of age on circadian variables}

#Older Adults
summary(lm(actamp ~ age, data = d[d$group == 1,])) #p = 0.0119
summary(lm(fact ~ age, data = d[d$group == 1,])) #p = 0.024507
summary(lm(actupmesor ~ age, data = d[d$group == 1,])) #NS
summary(lm(actdownmesor ~ age, data = d[d$group == 1,])) #NS

summary(lm(RA ~ age, data = d[d$group == 1,])) #NS
summary(lm(IS ~ age, data = d[d$group == 1,])) #NS
summary(lm(IV ~ age, data = d[d$group == 1,])) # p = 0.08

#Young Adults
summary(lm(actamp ~ age, data = d[d$group == 0,])) #NS
summary(lm(fact ~ age, data = d[d$group == 0,])) #NS
summary(lm(actupmesor ~ age, data = d[d$group == 0,])) #p = 0.0272
summary(lm(actdownmesor ~ age, data = d[d$group == 0,])) #p = 0.0206

summary(lm(RA ~ age, data = d[d$group == 0,])) #NS
summary(lm(IS ~ age, data = d[d$group == 0,])) #NS
summary(lm(IV ~ age, data = d[d$group == 0,])) #NS

```


```{r BCT vs rest-activity metrics}

d3.mlt <- melt(select(d, record_id, group_name, IS, wb_clustering_x:wb_betweenness_x), id.vars=c('record_id', 'group_name', 'IS'))

ggplot(data = d3.mlt) + 
  ggtitle('BCT Metrics and Interdaily Stability') + 
  geom_point(aes(x = value, y = IS, color = group_name), size=0.5) + 
  #stat_smooth(aes(x = value, y = ds_backward_score), method = 'loess', se = FALSE, fullrange = FALSE) +
  facet_wrap(~ variable,  scales='free') + 
  theme_minimal() +
  xlab(element_blank()) + ylab('Interdaily Stability') +
  scale_color_manual(values = c("blue", "red")) +
  theme(axis.text.y = element_blank(), axis.text.x = element_blank())

d3.mlt <- melt(select(d, record_id, group_name, IV, wb_clustering_x:wb_betweenness_x), id.vars=c('record_id', 'group_name', 'IV'))

ggplot(data = d3.mlt) + 
  ggtitle('BCT Metrics and Intradaily Variability') + 
  geom_point(aes(x = value, y = IV, color = group_name), size=0.5) + 
  #stat_smooth(aes(x = value, y = ds_backward_score), method = 'loess', se = FALSE, fullrange = FALSE) +
  facet_wrap(~ variable,  scales='free') + 
  theme_minimal() +
  xlab(element_blank()) + ylab('Intradaily Variability') +
  scale_color_manual(values = c("blue", "red")) +
  theme(axis.text.y = element_blank(), axis.text.x = element_blank())

d3.mlt <- melt(select(d, record_id, group_name, RA, wb_clustering_x:wb_betweenness_x), id.vars=c('record_id', 'group_name', 'RA'))

ggplot(data = d3.mlt) + 
  ggtitle('BCT Metrics and Relative Amplitude') + 
  geom_point(aes(x = value, y = RA, color = group_name), size=0.5) + 
  #stat_smooth(aes(x = value, y = ds_backward_score), method = 'loess', se = FALSE, fullrange = FALSE) +
  facet_wrap(~ variable,  scales='free') + 
  theme_minimal() +
  xlab(element_blank()) + ylab('Relative Amplitude') +
  scale_color_manual(values = c("blue", "red")) +
  theme(axis.text.y = element_blank(), axis.text.x = element_blank())

d3.mlt <- melt(select(d, record_id, group_name, fact, wb_clustering_x:wb_betweenness_x), id.vars=c('record_id', 'group_name', 'fact'))

ggplot(data = d3.mlt) + 
  ggtitle('BCT Metrics and Robustness') + 
  geom_point(aes(x = value, y = fact, color = group_name), size=0.5) + 
  #stat_smooth(aes(x = value, y = ds_backward_score), method = 'loess', se = FALSE, fullfactnge = FALSE) +
  facet_wrap(~ variable,  scales='free') + 
  theme_minimal() +
  xlab(element_blank()) + ylab('Robustness (F-statistic)') +
  scale_color_manual(values = c("blue", "red")) +
  theme(axis.text.y = element_blank(), axis.text.x = element_blank())

d3.mlt <- melt(select(d, record_id, group_name, actquot, wb_clustering_x:wb_betweenness_x), id.vars=c('record_id', 'group_name', 'actquot'))

ggplot(data = d3.mlt) + 
  ggtitle('BCT Metrics and Amplitude') + 
  geom_point(aes(x = value, y = actquot, color = group_name), size=0.5) + 
  #stat_smooth(aes(x = value, y = actquot, color = group_name), method = 'lm', se = FALSE, fullrange = FALSE) +
  facet_wrap(~ variable,  scales='free') + 
  theme_minimal() +
  xlab(element_blank()) + ylab('Amplitude Quotient') +
  scale_color_manual(values = c("blue", "red")) +
  theme(axis.text.y = element_blank(), axis.text.x = element_blank())

d3.mlt <- melt(select(d, record_id, group_name, sleep_time, wb_clustering_x:wb_betweenness_x), id.vars=c('record_id', 'group_name', 'sleep_time'))

ggplot(data = d3.mlt) + 
  ggtitle('BCT Metrics and Total Sleep Time') + 
  geom_point(aes(x = value, y = sleep_time, color = group_name), size=0.5) + 
  #stat_smooth(aes(x = value, y = sleep_time, color = group_name, ymax = 450), method = 'lm', se = FALSE, fullrange = FALSE) +
  facet_wrap(~ variable,  scales='free') + 
  theme_minimal() +
  xlab(element_blank()) + ylab('minutes') + ylim(150, 450) + 
  scale_color_manual(values = c("blue", "red")) +
  theme(axis.text.y = element_blank(), axis.text.x = element_blank())

```


```{r BCT vs neuropsych performance}

d3.mlt <- melt(select(d, record_id, group_name, cvlt_ldelay_recall_zscore, wb_clustering_x:wb_betweenness_x), id.vars=c('record_id', 'group_name', 'cvlt_ldelay_recall_zscore'))

ggplot(data = d3.mlt) + 
  ggtitle('BCT Metrics and CVLT Long Delay z-score') + 
  geom_point(aes(x = value, y = cvlt_ldelay_recall_zscore, color = "red"), size=0.5) + 
  stat_smooth(aes(x = value, y = cvlt_ldelay_recall_zscore, color = "red"), method = 'lm', se = FALSE, fullrange = FALSE) +
  facet_wrap(~ variable,  scales='free') + 
  theme_minimal() +
  xlab(element_blank()) + ylab('CVLT Long Delay') +
  theme(axis.text.y = element_blank(), axis.text.x = element_blank())

d3.mlt <- melt(select(d, record_id, group_name, cvlt_sdelay_recall_zscore, wb_clustering_x:wb_betweenness_x), id.vars=c('record_id', 'group_name', 'cvlt_sdelay_recall_zscore'))

ggplot(data = d3.mlt) + 
  ggtitle('BCT Metrics and CVLT Short Delay z-score') + 
  geom_point(aes(x = value, y = cvlt_sdelay_recall_zscore, color = "red"), size=0.5) + 
  stat_smooth(aes(x = value, y = cvlt_sdelay_recall_zscore, color = "red"), method = 'lm', se = FALSE, fullrange = FALSE) +
  facet_wrap(~ variable,  scales='free') + 
  theme_minimal() +
  xlab(element_blank()) + ylab('CVLT Short Delay') +
  theme(axis.text.y = element_blank(), axis.text.x = element_blank())

d3.mlt <- melt(select(d, record_id, group_name, ds_zscore, wb_clustering_x:wb_betweenness_x), id.vars=c('record_id', 'group_name', 'ds_zscore'))

ggplot(data = d3.mlt) + 
  ggtitle('BCT Metrics and DS z-score') + 
  geom_point(aes(x = value, y = ds_zscore, color = group_name), size=0.5) + 
  stat_smooth(aes(x = value, y = ds_zscore, color = group_name), method = 'lm', se = FALSE, fullrange = FALSE) +
  facet_wrap(~ variable,  scales='free') + 
  theme_minimal() +
  xlab(element_blank()) + ylab('DS') +
  scale_color_manual(values = c("blue", "red")) +
  theme(axis.text.y = element_blank(), axis.text.x = element_blank())

d3.mlt <- melt(select(d, record_id, group_name, trails_b_z_score, wb_clustering_x:wb_betweenness_x), id.vars=c('record_id', 'group_name', 'trails_b_z_score'))

ggplot(data = d3.mlt) + 
  ggtitle('BCT Metrics and TMT-B z-score') + 
  geom_point(aes(x = value, y = trails_b_z_score, color = group_name), size=0.5) + 
  stat_smooth(aes(x = value, y = trails_b_z_score, color = group_name), method = 'lm', se = FALSE, fullrange = FALSE) +
  facet_wrap(~ variable,  scales='free') + 
  theme_minimal() +
  xlab(element_blank()) + ylab('TMT-B') +
  scale_color_manual(values = c("blue", "red")) +
  theme(axis.text.y = element_blank(), axis.text.x = element_blank())

```

```{r}

library(corrplot)
d$ef_zscore <- rowMeans(d[c("trails_b_z_score", "ds_zscore")])

d_cor <- na.omit(select(d, IS:RA, actamp:fact, matches("wb_|dmn_|fpn_"), matches("zscore|z_score")))
M <- cor(d_cor)
corrplot(M)

```

```{r}

#https://sebastiansauer.github.io/vis_interaction_effects/
d$`Relative Amplitude` <- factor(ifelse(d$RA < median(d$RA, na.rm = TRUE), 0, 1), labels = c("Low", "High"))
d$`DMN Participation` <- factor(ifelse(d$dmn_participation_x < median(d$dmn_participation_x, na.rm = TRUE), 0, 1), labels = c("Low", "High"))

d %>% 
  subset(!is.na(`DMN Participation`)) %>%
  subset(!is.na(`Relative Amplitude`)) %>%
  ggplot() +
  aes(x = `DMN Participation`, color = group_name, group = group_name, y = trails_b_z_score) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('DMN Participation') + ylab('TMT-B')

summary(lm(dmn_participation_x ~ d$RA, data = d))
summary(lm(trails_b_z_score ~ dmn_participation_x*RA, data = d[d$group_name == "Young Adults",]))
summary(lm(trails_b_z_score ~ dmn_participation_x*IV, data = d[d$group_name == "Young Adults",]))
summary(lm(trails_b_z_score ~ dmn_participation_x*IS, data = d[d$group_name == "Young Adults",]))
summary(lm(trails_b_z_score ~ dmn_participation_x*sleep_time, data = d[d$group_name == "Young Adults",]))

summary(lm(trails_b_z_score ~ dmn_participation_x*RA, data = d[d$group_name == "Older Adults",])) # p < 0.05
summary(lm(trails_b_z_score ~ dmn_participation_x*IV, data = d[d$group_name == "Older Adults",])) # p < 0.05
summary(lm(trails_b_z_score ~ dmn_participation_x*IS, data = d[d$group_name == "Older Adults",]))
summary(lm(trails_b_z_score ~ dmn_participation_x*sleep_time, data = d[d$group_name == "Older Adults",]))

d$`Relative Amplitude` <- factor(ifelse(d$RA < median(d$RA, na.rm = TRUE), 0, 1), labels = c("Low", "High"))
d$`Intradaily Variability` <- factor(ifelse(d$IV < median(d$IV, na.rm = TRUE), 0, 1), labels = c("Low", "High"))
d$`Interdaily Stability` <- factor(ifelse(d$IS < median(d$IS, na.rm = TRUE), 0, 1), labels = c("Low", "High"))

summary(lm(trails_b_z_score ~ RA, data = d[d$group_name == "Older Adults",]))
d %>% 
  subset(group_name == "Older Adults") %>%
  subset(!is.na(`DMN Participation`)) %>%
  subset(!is.na(`Relative Amplitude`)) %>%
  ggplot() +
  aes(x = `Relative Amplitude`, color = `DMN Participation`, group = `DMN Participation`, y = trails_b_z_score) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('Relative Amplitude') + ylab('TMT-B')

d %>% 
  subset(group_name == "Older Adults") %>%
  subset(!is.na(`DMN Participation`)) %>%
  subset(!is.na(`Intradaily Variability`)) %>%
  ggplot() +
  aes(x = `Intradaily Variability`, color = `DMN Participation`, group = `DMN Participation`, y = trails_b_z_score) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('Intradaily Variability') + ylab('TMT-B')

d %>% 
  subset(group_name == "Older Adults") %>%
  subset(!is.na(`DMN Participation`)) %>%
  subset(!is.na(`Interdaily Stability`)) %>%
  ggplot() +
  aes(x = `Interdaily Stability`, color = `DMN Participation`, group = `DMN Participation`, y = trails_b_z_score) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('Interdaily Stability') + ylab('TMT-B') + ylim(-.25, .3)

###
summary(lm(dmn_participation_x ~ group*RA, data = d))
ggplot(data = d) + 
  ggtitle('RA and DMN Participation') + 
  geom_point(aes(x = RA, y = dmn_participation_x, color = group_name), size=0.5) + 
  stat_smooth(aes(x = RA, y = dmn_participation_x, color = group_name), method = 'loess', se = FALSE, fullrange = FALSE) +
  theme_minimal() +
  xlab("Relative Amplitude") + ylab("DMN Participation Coefficient") +
  scale_color_manual(values = c("blue", "red"))

summary(lm(vc_zscore ~ dmn_participation_x, data = d))
ggplot(data = d) + 
  ggtitle('DMN Participation and Vocabulary') + 
  geom_point(aes(x = dmn_participation_x, y = vc_zscore, color = group_name), size=0.5) + 
  stat_smooth(aes(x = dmn_participation_x, y = vc_zscore), method = 'lm', se = FALSE, fullrange = FALSE) +
  theme_minimal() +
  xlab("DMN Participation Coefficient") + ylab("WAIS Vocabulary Z-Score") +
  scale_color_manual(values = c("blue", "red"))

```


```{r DMN participation vs. neuropsych}

d$tmt_group <- factor(ifelse(d$trails_b_z_score < median(d$trails_b_z_score, na.rm = TRUE), 0, 1), labels = c("Low", "High"))
d$cvlt_group <- factor(ifelse(d$cvlt_ldelay_recall_zscore < median(d$cvlt_sdelay_recall_zscore, na.rm = TRUE), 0, 1), labels = c("Low", "High"))
d$ds_group <- factor(ifelse(d$ds_zscore < median(d$ds_zscore, na.rm = TRUE), 0, 1), labels = c("Low", "High"))
d$vc_group <- factor(ifelse(d$vc_zscore < median(d$vc_zscore, na.rm = TRUE), 0, 1), labels = c("Low", "High"))
d$cowat_group <- factor(ifelse(d$cowat_zscore < median(d$cowat_zscore, na.rm = TRUE), 0, 1), labels = c("Low", "High"))
d$`DMN Participation` <- factor(ifelse(d$dmn_participation_x < median(d$dmn_participation_x, na.rm = TRUE), 1, 0), labels = c("Low", "High"))

# TMT-B - NS
summary(lm(trails_b_z_score ~ dmn_participation_x + group, data = d))
d %>% 
  filter(!is.na(`DMN Participation`)) %>%
  ggplot() +
  aes(x = `DMN Participation`, color = group_name, group = group_name, y = trails_b_z_score) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('DMN Participation Coefficient') + ylab('TMT-B Performance')
  
# CVLT - NS
summary(lm(cvlt_ldelay_recall_zscore ~ dmn_participation_x, data = d))
d %>% 
  filter(!is.na(`DMN Participation`)) %>%
  ggplot() +
  aes(x = `DMN Participation`, color = group_name, group = group_name, y = cvlt_ldelay_recall_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('DMN Participation Coefficient') + ylab('CVLT L Delay Performance')
  
# DS-B - NS
summary(lm(ds_zscore ~ dmn_participation_x, data = d))
d %>% 
  filter(!is.na(`DMN Participation`)) %>%
  ggplot() +
  aes(x = `DMN Participation`, color = group_name, group = group_name, y = ds_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('DMN Participation Coefficient') + ylab('Digit Span Performance')

# COWAT - NS
summary(lm(cowat_zscore ~ dmn_participation_x, data = d))
d %>% 
  filter(!is.na(`DMN Participation`)) %>%
  ggplot() +
  aes(x = `DMN Participation`, color = group_name, group = group_name, y = cowat_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('DMN Participation Coefficient') + ylab('COWAT Performance')

# Vocabulary - p = 0.0136
summary(lm(vc_zscore ~ dmn_participation_x, data = d))
d %>% 
  filter(!is.na(`DMN Participation`)) %>%
  ggplot() +
  aes(x = `DMN Participation`, color = group_name, group = group_name, y = vc_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('DMN Participation Coefficient') + ylab('Vocabulary Performance')

```


```{r FPN participation vs. neuropsych}

d$`FPN Participation` <- factor(ifelse(d$fpn_participation_x < median(d$fpn_participation_x, na.rm = TRUE), 1, 0), labels = c("Low", "High"))

# TMT-B - p = 0.00951 interaction
summary(lm(trails_b_z_score ~ fpn_participation_x*group, data = d))
d %>% 
  filter(!is.na(`FPN Participation`)) %>%
  ggplot() +
  aes(x = `FPN Participation`, color = group_name, group = group_name, y = trails_b_z_score) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('FPN Participation Coefficient') + ylab('TMT-B Performance')
  
# CVLT - NS
summary(lm(cvlt_ldelay_recall_zscore ~ fpn_participation_x, data = d))
d %>% 
  filter(!is.na(`FPN Participation`)) %>%
  ggplot() +
  aes(x = `FPN Participation`, color = group_name, group = group_name, y = cvlt_ldelay_recall_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('FPN Participation Coefficient') + ylab('CVLT L Delay Performance')
  
# DS-B - NS
summary(lm(ds_zscore ~ fpn_participation_x, data = d))
d %>% 
  filter(!is.na(`FPN Participation`)) %>%
  ggplot() +
  aes(x = `FPN Participation`, color = group_name, group = group_name, y = ds_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('FPN Participation Coefficient') + ylab('Digit Span Performance')

# COWAT - NS
summary(lm(cowat_zscore ~ fpn_participation_x, data = d))
d %>% 
  filter(!is.na(`FPN Participation`)) %>%
  ggplot() +
  aes(x = `FPN Participation`, color = group_name, group = group_name, y = cowat_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('FPN Participation Coefficient') + ylab('COWAT Performance')

# Vocabulary - ** p = 0.00517
summary(lm(vc_zscore ~ fpn_participation_x, data = d))
d %>% 
  filter(!is.na(`FPN Participation`)) %>%
  ggplot() +
  aes(x = `FPN Participation`, color = group_name, group = group_name, y = vc_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('FPN Participation Coefficient') + ylab('Vocabulary Performance')

```


```{r Modularity vs. Neuropsych}

d$`WB Modularity` <- factor(ifelse(d$wb_modularity_x < median(d$wb_modularity_x, na.rm = TRUE), 1, 0), labels = c("Low", "High"))

# TMT-B - NS
summary(lm(trails_b_z_score ~ wb_modularity_x + group, data = d))
d %>% 
  filter(!is.na(`WB Modularity`)) %>%
  ggplot() +
  aes(x = `WB Modularity`, color = group_name, group = group_name, y = trails_b_z_score) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('WB Modularity') + ylab('TMT-B Performance')
  
# CVLT - NS
summary(lm(cvlt_ldelay_recall_zscore ~ wb_modularity_x, data = d))
d %>% 
  filter(!is.na(`WB Modularity`)) %>%
  ggplot() +
  aes(x = `WB Modularity`, color = group_name, group = group_name, y = cvlt_ldelay_recall_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('WB Modularity') + ylab('CVLT L Delay Performance')
  
# DS-B - NS
summary(lm(ds_zscore ~ wb_modularity_x + group, data = d))
d %>% 
  filter(!is.na(`WB Modularity`)) %>%
  ggplot() +
  aes(x = `WB Modularity`, color = group_name, group = group_name, y = ds_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('WB Modularity') + ylab('Digit Span Performance')

# COWAT - NS
summary(lm(cowat_zscore ~ wb_modularity_x, data = d))
d %>% 
  filter(!is.na(`WB Modularity`)) %>%
  ggplot() +
  aes(x = `WB Modularity`, color = group_name, group = group_name, y = cowat_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('WB Modularity') + ylab('COWAT Performance')

# Vocabulary - p = 0.0325
summary(lm(vc_zscore ~ wb_modularity_x + group, data = d))
d %>% 
  filter(!is.na(`WB Modularity`)) %>%
  ggplot() +
  aes(x = `WB Modularity`, color = group_name, group = group_name, y = vc_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('WB Modularity') + ylab('Vocabulary Performance')

```

```{r DMN Participation vs Circadian Measures}

d$`DMN Participation` <- factor(ifelse(d$dmn_participation_x < median(d$dmn_participation_x, na.rm = TRUE), 1, 0), labels = c("Low", "High"))
d$`FPN Participation` <- factor(ifelse(d$fpn_participation_x < median(d$fpn_participation_x, na.rm = TRUE), 1, 0), labels = c("Low", "High"))

# RA
summary(lm(dmn_participation_x ~ RA*group, data = d)) # *
summary(lm(fpn_participation_x ~ RA + group, data = d)) # NS
d %>% 
  filter(!is.na(`DMN Participation`)) %>%
  ggplot() +
  aes(x = `DMN Participation`, color = group_name, group = group_name, y = RA ) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) + 
  xlab('DMN Participation Coefficient') + ylab('Relative Amplitude')

# IS
summary(lm(dmn_participation_x ~ IS, data = d)) # NS
summary(lm(fpn_participation_x ~ IS + group, data = d)) # NS, p = 0.07 int
d %>% 
  filter(!is.na(`DMN Participation`)) %>%
  ggplot() +
  aes(x = `DMN Participation`, color = group_name, group = group_name, y = IS ) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) + 
  xlab('DMN Participation Coefficient') + ylab('Interdaily Stability')

# IV
summary(lm(dmn_participation_x ~ IV + group, data = d)) # NS
summary(lm(fpn_participation_x ~ IV + group, data = d)) # NS
d %>% 
  filter(!is.na(`DMN Participation`)) %>%
  ggplot() +
  aes(x = `DMN Participation`, color = group_name, group = group_name, y = IV ) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) + 
  xlab('DMN Participation Coefficient') + ylab('Intradaily Variability')

# fact
summary(lm(dmn_participation_x ~ fact*group, data = d)) # p = 0.01717
summary(lm(fpn_participation_x ~ fact + group, data = d)) # NS
d %>% 
  filter(!is.na(`DMN Participation`)) %>%
  ggplot() +
  aes(x = `DMN Participation`, color = group_name, group = group_name, y = fact ) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) + 
  xlab('DMN Participation Coefficient') + ylab('Robustness (F)')

# quotient
summary(lm(dmn_participation_x ~ actquot*group, data = d)) # p = 0.0246
summary(lm(fpn_participation_x ~ actquot + group, data = d)) # NS

d %>% 
  filter(!is.na(`DMN Participation`)) %>%
  ggplot() +
  aes(x = `DMN Participation`, color = group_name, group = group_name, y = actquot ) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) + 
  xlab('DMN Participation Coefficient') + ylab('Amplitude Quotient')

d %>%
  ggplot() + 
  aes(x = fact, y = dmn_participation_x, color = group_name, group = group_name) +
  geom_point() + 
  stat_smooth(method = "lm") 

```


```{r bct and neuropsych by rest-activity robustness}

d$`RA Group` <- factor(ifelse(d$RA < median(d$RA, na.rm = TRUE), 1, 0), labels = c("Low", "High"))

# TMT-B
d %>% 
  na.omit() %>%
  ggplot() +
  aes(x = `RA Group`, color = `DMN Participation`, group = `DMN Participation`, y = trails_b_z_score) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('RA') + ylab('TMT-B Performance')
  
# CVLT
d %>% 
  na.omit() %>%
  ggplot() +
  aes(x = `RA Group`, color = `DMN Participation`, group = `DMN Participation`, y = cvlt_ldelay_recall_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('RA') + ylab('CVLT Long Performance')
  
# DS
d %>% 
  na.omit() %>%
  ggplot() +
  aes(x = `RA Group`, color = `DMN Participation`, group = `DMN Participation`, y = ds_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('RA') + ylab('DS Performance')

# COWAT
d %>% 
  na.omit() %>%
  ggplot() +
  aes(x = `RA Group`, color = `DMN Participation`, group = `DMN Participation`, y = cowat_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) +
  xlab('RA') + ylab('COWAT Performance')

# Vocabulary
d %>% 
  na.omit() %>%
  ggplot() +
  aes(x = `RA Group`, color = `DMN Participation`, group = `DMN Participation`, y = vc_zscore) +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "point") +
  stat_summary(fun.y = mean, na.rm = TRUE, geom = "line") + 
  scale_color_manual(values = c("blue", "red")) + 
  xlab('RA') + ylab('WAIS Vocabulary Performance')

```


```{r}
library(tidyverse)
library(readr)
library(corrr)
library(reshape2)

pcoef <- read_csv('~/Box/CogNeuroLab/Aging Decision Making R01/Analysis/rest/bct/participation_nodewise.csv', col_names = TRUE )
neuro <- read_csv('~/Box/CogNeuroLab/Aging Decision Making R01/Data/Neuropsych/AgingDecMemNeuropsyc_DATA_2019-06-12_0708.csv')

schaefer_labels <- t(read_csv('~/Box/CogNeuroLab/Aging Decision Making R01/Analysis/rest/schaefer400/schaefer400x7NodeNames.txt', col_names = FALSE))
colnames(pcoef) <- c("record_id", schaefer_labels)
write_csv(pcoef, '~/Box/CogNeuroLab/Aging Decision Making R01/Analysis/rest/bct/participation_nodewise_r.csv')

pcoef <- select(pcoef, record_id, matches("Default|Cont"))
pcoef <- merge(pcoef, dplyr::select(neuro, record_id, vc_zscore, cvlt_ldelay_recall_zscore, cowat_zscore, ds_zscore, trails_b_z_score), by = 'record_id')
pcoef$ef_zscore <- (pcoef$trails_b_z_score + pcoef$ds_zscore )/2
OA_cor_data <- filter(pcoef, record_id > 40000)
YA_cor_data <- filter(pcoef, record_id < 40000)

#record_id <- pcoef$record_id
#pcoef$group <- ifelse(record_id > 40000, 0, 1)

pcoef %>% 
  select(vc_zscore, cvlt_ldelay_recall_zscore, cowat_zscore, ds_zscore, trails_b_z_score, ef_zscore) %>% 
  gather() %>% 
  ggplot(aes(value)) +
    geom_histogram() +
    facet_wrap(~key, scales = "free")

focus_cog_OA <- OA_cor_data %>%
  correlate(method = "spearman") %>%
  focus(vc_zscore, ds_zscore, trails_b_z_score, cvlt_ldelay_recall_zscore, cowat_zscore, ef_zscore)

focus_cog_YA <- YA_cor_data %>%
  correlate(method = "spearman") %>%
  focus(vc_zscore, ds_zscore, trails_b_z_score, ef_zscore)

focus_cog_OA.mlt <- melt(focus_cog_OA, id.vars = 'rowname')
focus_cog_YA.mlt <- melt(focus_cog_YA, id.vars = 'rowname')
focus_cog <- merge(focus_cog_YA.mlt, focus_cog_OA.mlt, by = c("rowname", "variable"))

ggplot(data = na.omit(focus_cog_OA.mlt[abs(focus_cog_OA.mlt$value) > 0.27,]), aes(x = value, y = rowname)) + 
  geom_point(color = 'red') + 
  geom_point(data = drop_na(focus_cog_YA.mlt[abs(focus_cog_YA.mlt$value) > 0.27,]), color = 'blue') + 
  facet_grid( ~ variable,  scales='fixed')

```
